C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 1   


C51 COMPILER V7.09, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\Keil\C51\BIN\C51.EXE main.c DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************
   2           * EVB900A-V1¿ª·¢°åÊµÑé³ÌÐò                                              *
   3           * °æ±¾£º (C) Copyright 2010,SC.etc,DCL,CHM    All Rights reserved.      *
   4           * ÍøÕ¾£º mcuep.taobao.com                            *
   5           * ÓÊÏä£º dcl0@sina.com                                                  *
   6           * ×÷Õß£º DCL,CHM
   7           * À´Ô´£º Ë¼´´µç×Ó  Xa' STrong ELECTRONICS CO.,LTD      *
   8           *¡¾°æÈ¨¡¿Copyright(A) Ë¼´´µç×Ó mcuep.taobao.com  All Rights Reserved    *
   9           *¡¾ÉùÃ÷¡¿´Ë³ÌÐò½öÓÃÓÚÑ§Ï°Óë²Î¿¼£¬ÒýÓÃÇë×¢Ã÷°æÈ¨ºÍ×÷ÕßÐÅÏ¢£¡             *
  10           *************************************************************************/
  11          #include "C8051F340.H"
  12          #include "intrins.h"
  13          #include "SIM900a.h"
  14          #include "lc1602.h"
  15          #include "lc12864.h"
  16          #include "1.h"
  17          #include "DS18B20.h"
  18          
  19          sbit SP485_RS     =   P0^3;//485_RS
  20          
  21          sbit SPK          =   P2^5;//·äÃùÆ÷
  22          sbit GPRS_EN      =   P2^6; //GPRS Ê¹ÄÜ
  23          
  24          sbit JDQ_C1       =   P3^3;//¼ÌµçÆ÷1
  25          sbit JDQ_C2       =   P3^4;//¼ÌµçÆ÷2
  26          sbit JDQ_C3       =   P3^5;//¼ÌµçÆ÷3
  27          sbit JDQ_C4       =   P3^6;//¼ÌµçÆ÷4
  28          
  29          
  30          
  31          sbit KEY_C1       =   P0^6;//KEY1
  32          sbit KEY_C2       =   P0^7;//KEY2
  33          sbit KEY_C3       =   P1^0;//KEY3
  34          
  35          sbit LED_C1       =   P1^1;//LED1
  36          sbit LED_C2       =   P1^2;//LED2
  37          
  38          ///////////////////DTMFÉèÖÃ//////////////////////////////
  39          //ÐèÒªÅäÖÃÍâ²¿ÖÐ¶Ï
  40          sbit DTMF_DV      =   P2^4;//¸ßµçÆ½ÓÐÐ§(½ÓÊÕµ½DTMF)
  41          sbit DTMF_OE      =   P1^7;//¸ßµçÆ½ÓÐÐ§(½âÂë³É¹¦)
  42          //D0-P2.0  D1=P2.1  D2=P2.2  D3=P2.3
  43          
  44          ///////////´®¿Ú1²¿·Ö²»ÄÜÎ»²Ù×÷/////////////////
  45          #define IsTI1 (SCON1&0x02)
  46          #define IsRI1 (SCON1&0x01)
  47          #define ClrTI1() SCON1&=~0x02;
  48          #define ClrRI1() SCON1&=~0x01;
  49          ///////////¿ØÖÆÆ÷ÅäÖÃÐÅÏ¢²Ù×÷/////////////////
  50          unsigned char xdata SIM_NUM[20]; //´æ·ÅSIM¿¨ºÅÂë(20Î»)
  51          unsigned char xdata Rx=0;
  52          unsigned char xdata SIM900a_BUF[70];//SIM900a´¢´æ³ö¿Ú½ÓÊÕÊý¾Ý
  53          unsigned char xdata GSM_BUF[300];//SIM900a´¢´æ¶ÌÐÅÊý¾Ý 
  54          ///////////LCDÖ¸Ê¾µÆ²Ù×÷/////////////////
  55          //#define LCM_Data  P1   //Êý¾ÝÏß
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 2   

  56          //#define Busy    0x80   //ÓÃÓÚ¼ì²âLCM×´Ì¬×ÖÖÐµÄBusy±êÊ¶
  57          
  58          ////////////////////////LCD1602Òº¾§»¶Ó­ÏÔÊ¾/////////////////////////////////////////////////////////////
  59          unsigned char code uctech[] = {"Welcome!"};
  60          unsigned char code net[] = {"mcuep.taobao.com"};
  61          
  62          ////////////////////////GPS¶¨Î»²âÊÔÊµÑé/////////////////////////////////////////////////////////////////
  63          unsigned char code net2[]         = {"GPS TEST"};
  64          unsigned char code Lat[]          = {"LAT:"};            //Î³¶ÈÍ·±ê
  65          unsigned char code Longt[]        = {"LG:"};             //¾­¶ÈÍ·±ê
  66          unsigned char code NO_SIM_LINK[]  = {"NO_MODUL_LINK!!"};  //900aÄ£¿éÓëµ¥Æ¬»ú´®¿ÚÎ´Áª½Ó£¬¿ÉÄÜÔ­Òò:1.ÌøÏßÃ°Î
             -´¶Ï½Ó(ÓÒ); 2.Ä£¿éÎ´Æô¶¯(µ÷ÊÔ³ÌÐòÖÐ)
  67          
  68          unsigned char code net3[]         = {"ÎÀÐÇ¶¨Î»ÊµÑé"};
  69          unsigned char code gps_tm[]       = {"Ê±¼ä:"}; 
  70          unsigned char code gps_lg[]       = {"¾­¶È:"};     
  71          unsigned char code gps_long[]     = {"Î³¶È:"};  
  72          
  73          ////////////////////////DS18B20ÎÂ¶È²âÊÔÊµÑé//////////////////////////////////////////////////////////////
  74          unsigned char code net4[]     = {"ÎÂ¶È¿ØÖÆÊµÑé"};
  75          unsigned char code tm_up[]    = {"ÎÂ¶ÈÉÏÏÞ:"};
  76          unsigned char code tm_down[]  = {"ÎÂ¶ÈÏÂÏÞ:"};
  77          unsigned char tm_up_point=40   ;   //ÎÂ¶ÈÉÏÏÞ
  78          unsigned char tm_down_point=25 ;   //ÎÂ¶ÈÏÂÏÞ
  79          unsigned char code tm_p[]     = {"µ±Ç°ÎÂ¶È:"};
  80          unsigned char  DS18B20_sn[8];  //4¸öÆ÷¼þµÄÐòÁÐºÅ£¬ÏÈ¶Á³öµ¥¸öÐòÁÐºÅºóÌîÉÏ²Å¿ÉÒÔ¶ÁÈ¡ÎÂ¶È
  81          ////////////////////////GPS²Ù×÷/////////////////////////////////////////////
  82          unsigned char xdata GPS_head_buf[5];//GPSÃüÁî×Ö´æ·Å
  83          unsigned char xdata head__point=0;
  84          unsigned char xdata GPS_data_buf[60];//GPSÊý¾ÝÐÅÏ¢´æ·Å
  85          unsigned char xdata data__point=0;
  86          unsigned char xdata GPS_Flg1=0;//GPS½ÓÊÕÃüÁî±êÖ¾Î»
  87          unsigned char xdata GPS_Flg2=0;//GPS½ÓÊÕÐÅÏ¢±êÖ¾Î»
  88          unsigned char xdata GPS_data_ok_flg=0;//GPSÊý¾Ý½ÓÊÕÒ»´ÎÍê³É±êÖ¾
  89          unsigned char xdata GPS_inf_state=0; //Ëù½ÓÊÕ±¨ÎÄµÄÓÐÐ§ÐÔ A:¿ÉÓÃ   V:²»¿ÉÓÃ
  90          unsigned char xdata GPS_can_use=0;   //1:Ö÷³ÌÐò¿ÉÓÃ 0:²»¿ÉÓÃ 
  91          ///////////·äÃùÆ÷²Ù×÷/////////////////
  92          #define spk_1  SPK=0;   delay_10ms(20);      SPK=1; delay_10ms(30);
  93          #define spk_2  SPK=0;   delay_10ms(40);      SPK=1; delay_10ms(100);
  94          #define spk_3  SPK=0;   delay_10ms(50);      SPK=1; delay_10ms(400);
  95          #define spk_4  SPK=0;   delay_10ms(60);      SPK=1; delay_10ms(200);
  96          //************Ó²¼þ³õÊ¼»¯²¿·Ý**********************************************
  97          void Port_IO_Init()
  98          {        
  99   1              P0MDOUT   = 0xC0;
 100   1              //P1MDOUT   = 0xFF;
 101   1              //P2MDOUT   = 0x01;
 102   1              P3MDOUT   = 0x00;
 103   1              P4MDOUT   = 0x00;//P4¿Ú²»ÄÜ°´Î»²Ù×÷
 104   1          XBR0      = 0x01;
 105   1          XBR1      = 0x40;
 106   1          XBR2      = 0x01;
 107   1      }
 108          //************************************************************************
 109          //UART0:Ê¹ÓÃtime1 115200BPS; UART1:Ê¹ÓÃtime1 19200BPS
 110          //************************************************************************/
 111          void Timer_Init()
 112          {
 113   1          TCON      = 0x40;
 114   1          TMOD      = 0x20;
 115   1          CKCON     = 0x08;
 116   1          TH1       = 0x30;
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 3   

 117   1      }
 118          //************************************************************************
 119          //´®¿Ú³õÊ¼»¯£¬ÅäÖÃ£ºUART0=115200BPS,UART1=9600BPS,Ê¹ÄÜ´®¿Ú½ÓÊÕ
 120          //************************************************************************/
 121          void UART_Init()
 122          {
 123   1          SCON0     = 0x10;
 124   1      
 125   1          SBRLL1    = 0x1E;  //19200bps     ×¢£ºÐèÒª19200Çë´ò¿ª
 126   1          SBRLH1    = 0xFB;  //19200bps
 127   1      
 128   1              //SBRLL1    = 0x3C;    //9600bps      ×¢£ºÐèÒª9600Çë´ò¿ª
 129   1          //SBRLH1    = 0xF6;    //9600bps
 130   1      
 131   1          SCON1     = 0x10;
 132   1          SBCON1    = 0x43;
 133   1      }
 134          
 135          //************************************************************************
 136          //ÏµÍ³Ê±ÖÓ³õÊ¼»¯£¬48M Ñ¡ÔñÍâ²¿¾§ÌåÕñµ´Æ÷
 137          //************************************************************************/
 138          void Oscillator_Init()
 139          {
 140   1          int i = 0;
 141   1          OSCICN    = 0x83;
 142   1          CLKMUL    = 0x80;
 143   1          for (i = 0; i < 20; i++);    // Wait 5us for initialization
 144   1          CLKMUL    |= 0xC0;
 145   1          while ((CLKMUL & 0x20) == 0);
 146   1          CLKSEL    = 0x03;
 147   1      
 148   1      }
 149          //************************************************************************
 150          //¿ª´®¿Ú0/´®¿Ú1/×ÜÖÐ¶Ï
 151          //************************************************************************/
 152          void Interrupts_Init()
 153          {
 154   1          EIE2      = 0x02;
 155   1          IE        = 0x90;
 156   1      }
 157          void Init_Device(void)
 158          {
 159   1          PCA0MD &= ~0x40;//¹Ø±Õ¿´ÃÅ¹·¶¨Ê±Æ÷ 
 160   1          Timer_Init();
 161   1          UART_Init();
 162   1          Port_IO_Init();
 163   1          Oscillator_Init();
 164   1          Interrupts_Init();
 165   1      }
 166          void Delay_ms(unsigned int i)
 167          {
 168   1          unsigned char j;
 169   1              unsigned char k;
 170   1              for (k=0;k<12;k++)
 171   1              {
 172   2                  for(;i>0;i--)
 173   2                      {
 174   3                      for(j=0;j<125;j++){;}
 175   3                      
 176   3                      }
 177   2              }
 178   1      }
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 4   

 179          void delay_1ms(unsigned char _1ms)// Delay 1ms
 180          {
 181   1          unsigned char i;
 182   1          unsigned int  j;
 183   1      
 184   1              for (i=0;i<_1ms;i++)
 185   1              {
 186   2                 for(j=0;j<2400;j++)
 187   2                 ;
 188   2              }
 189   1      }
 190          void delay_10ms(unsigned int _10ms)// Delay 10ms
 191          {
 192   1        unsigned int  i;
 193   1        for (i=0;i<_10ms;i++)
 194   1        {
 195   2          delay_1ms(10);
 196   2        }
 197   1      
 198   1      }
 199          //////////////////////////////////////////////////////////////////////////////
 200          //////////////////////////////////////////////////////////////////////////////
 201          void sendchar(unsigned char ch)
 202          { 
 203   1          EA=0;
 204   1              SBUF0=ch;
 205   1              while(TI0==0);
 206   1              TI0=0;
 207   1              EA=1;
 208   1      }
 209          /*********************************************************************************************************
             -*******/
 210          ///////////////////////////////////////µ¥Æ¬»úÆô¶¯SIMCOMÄ£¿é/////////////////////////////////
 211          /*********************************************************************************************************
             -*******/
 212          void Start_GSM(void)
 213          {
 214   1      
 215   1              GPRS_EN=0;
 216   1          Delay_ms(60000);Delay_ms(60000);
 217   1          //GPRS_EN=1;
 218   1              Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 219   1      }
 220          /*********************************************************************************************************
             -*******/
 221          ///////////////////////////////////////void clear_SIM900a_BUF();Çå³ý´®¿Ú½ÓÊÕ»º³åÇø////////////////////////
             -/////////
 222          /*********************************************************************************************************
             -*******/
 223          void clear_SIM900a_BUF()
 224          {
 225   1          unsigned char i;
 226   1              for(i=0;i<70;i++)
 227   1              {
 228   2                      SIM900a_BUF[i]=0;
 229   2              }
 230   1              Rx=0;
 231   1      }
 232          void clear_GSM_BUF()
 233          {
 234   1          unsigned char i;
 235   1              for(i=0;i<100;i++)
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 5   

 236   1              {
 237   2                      GSM_BUF[i]=0;
 238   2              }
 239   1              Rx=0;
 240   1      }
 241          //////////////////////////////////////////////////////////////////////////////
 242          //¼ì²éSIM900aÄ£¿é¹¤×÷×´Ì¬£¬ÒÔ¼°¶ÁÈ¡SIM¿¨ºÅ·ÅÈë-->SIM_NUM
 243          //////////////////////////////////////////////////////////////////////////////
 244          void GSM_check(void)
 245          { 
 246   1          unsigned char  i,j;
 247   1              while(1)
 248   1              {
 249   2                  clear_SIM900a_BUF();
 250   2                  sendstring(AT);
 251   2                      Delay_ms(10000);
 252   2                      j++;
 253   2                  if((SIM900a_BUF[6]=='O')&&(SIM900a_BUF[7]=='K'))//ÅÐ¶ÏÊÇ·ñÄ£¿é³õÊ¼»¯³É¹¦,³É¹¦µÄ»°Ä£¿é»á»Ø¸´"OK"¸øµ¥Æ¬
             -»ú------>ÓÃ»§¸ù¾Ý·ÂÕæÆ÷¼à¿Ø½ÓÊÕÊý×é£¬¸Ä¶¯»ØÁîOKÊý¾Ý´æ·ÅÎ»ÖÃ
 254   2              {                                                                                               //Èç¹ûµ¥Æ¬»úÃ»ÓÐÊÕµ½OK,¾Í¼ÌÐø·¢ËÍ³õÊ¼»¯Ö¸Áî/ 
 255   3                 clear_SIM900a_BUF();
 256   3                 sendstring(AT_CCID);Delay_ms(10000); //²éSIM¿¨ºÅ  89860 0C226 10A74 59948(20Î»ASCIIÂë±íÊ¾)     
             -   
 257   3                         for(i=11;i<31;i++)
 258   3                     {
 259   4                               SIM_NUM[i-11]=SIM900a_BUF[i];
 260   4                     }
 261   3                         spk_1;//ÉÏµç·äÃùÆ÷½Ð
 262   3                         break;       
 263   3              }
 264   2                      if(j>15)//ÌáÊ¾:SIM900BÄ£¿éÓëµ¥Æ¬»úÍ¨Ñ¶Î´Áª½Ó
 265   2                      {      
 266   3                      //LCMInit_1602(); //LCD1602Òº¾§³õÊ¼»¯
 267   3                  //DisplayListChar(0, 0,13, NO_SIM_LINK);   //ÔÚµÚ1ÐÐÏÔÊ¾"NO-NO_SIM_LINK-!!"
 268   3      
 269   3                              LCMInit_12864(); //LCD12864Òº¾§³õÊ¼»¯
 270   3                  Display_String(0,1,NO_SIM_LINK,15);
 271   3                  Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 272   3                  break;
 273   3                      }
 274   2              }
 275   1      }
 276          //*************************SIM300³ÌÐò******************************************************/
 277          //*****************************************************************************************/
 278          /*********************************************************************
 279          //±¾º¯ÊýÊÇÓÃÀ´¼ì²é×Ö·û´®*STRING_muchÊÇ·ñÍêÈ«°üº¬ÔÚ"@:"×Ö·û
 280          //·µ»Ø:  0  Ã»ÓÐÕÒµ½
 281          //1-255 ´ÓµÚN¸ö×Ö·û¿ªÊ¼ÏàÍ¬
 282           *********************************************************************/
 283          unsigned char strsearch_head(unsigned char *STRING_much)//²é×Ö·û´®*STRING_littleÔÚ*STRING_muchÖÐµÄÎ»ÖÃ
 284          {
 285   1              unsigned char i;
 286   1              for(i=0;i<300;i++)
 287   1              {
 288   2                      if(STRING_much[i]==0x40)//µÚÒ»¸ö×Ö·ûÏàÍ¬
 289   2                      {       
 290   3                                      if(STRING_much[i+1]==0x3A) //±È½ÏÕýÈ·
 291   3                                      {
 292   4                                 return(i+2); //·µ»ØÖµÊÇÕûÊý
 293   4                                      }
 294   3                      }
 295   2              }
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 6   

 296   1              return(0);
 297   1      }
 298          void sendstring(unsigned char *p)
 299          {
 300   1              while(*p)
 301   1              {
 302   2                      sendchar(*p);
 303   2                      p++;
 304   2              }
 305   1              sendchar(0x0D);
 306   1              sendchar(0x0A);
 307   1      }
 308          void send_string(unsigned char *p,unsigned char num)
 309          {
 310   1         unsigned char xdata i;
 311   1         for(i=0;i<num;i++)
 312   1         {
 313   2                sendchar(*p);
 314   2            p++;
 315   2         } 
 316   1              sendchar(0x0D);
 317   1              sendchar(0x0A);  
 318   1      }
 319          void send_matrix(unsigned char *p,unsigned char num)
 320          {
 321   1         unsigned char xdata i;
 322   1         for(i=0;i<num;i++)
 323   1         {
 324   2                sendchar(*p);
 325   2            p++;
 326   2         }   
 327   1      }
 328          //¿ØÖÆÆ÷485·¢ËÍ³ÌÐò
 329          //´®¿Ú1 19200bps/»òÕß9600bps£º   ¸ù¾ÝUART_Init()ËµÃ÷½øÐÐµÚ¶þ´®¿Ú²¨ÌØÂÊÑ¡Ôñ
 330          /////////////////////////////////////////////////////////////////////////
 331          void max485_send(unsigned char XXX)
 332          {
 333   1          EA=0;
 334   1              SP485_RS=1;
 335   1          SBUF1=XXX;
 336   1              while(!IsTI1);
 337   1              ClrTI1();
 338   1              EA=1;
 339   1              SP485_RS=0;
 340   1      }
 341          ///////////////DS18B20/////////////////////////////
 342          void Read_B20_SN(void) //¶ÁÈ¡ÐòÁÐºÅ
 343          { 
 344   1        unsigned char i;
 345   1      
 346   1        Init_DS18B20(); //¸´Î» 
 347   1        DS18B20_1us(100); //·¢¶ÁÈ¡µçÔ´¹¤×÷·½Ê½Ö¸Áî 
 348   1        write_byte(0x33); //·¢ËÍ¶ÁÐòÁÐºÅ×Ó³ÌÐò 
 349   1        for(i=0;i<8;i++) //ÒòÎªÊÇ8¸ö×Ö½Ú£¬ËùÒÔÒª¶ÁÈ¡8´Î
 350   1        {
 351   2          DS18B20_sn[i]=read_byte(); //¶ÁÈ¡ÐòÁÐºÅ
 352   2        }
 353   1      }
 354          ///////////////////////////////////////////////////////////////////////
 355          // Ö÷³ÌÐò¿ªÊ¼
 356          ///////////////////////////////////////////////////////////////////////
 357          void main(void)
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 7   

 358          {
 359   1          unsigned char code table[]={"0123456789ABCDEF"}; //ÓÃÓÚ1602ÏÔÊ¾
 360   1      
 361   1              unsigned char GPS_hour;  //GPS¶¨Î»ÊµÑé:ÖÐ¼ä±äÁ¿
 362   1              
 363   1              unsigned int TT;         //DS18B20ÊµÑé:ÎÂ¶ÈÖµ   
 364   1              unsigned char table_temp[6];   //DS18B20ÊµÑé:ÖÐ¼ä±äÁ¿
 365   1              unsigned char table_temp2[4];  //DS18B20ÊµÑé:ÖÐ¼ä±äÁ¿
 366   1              unsigned char table_temp3[4];  //DS18B20ÊµÑé:ÖÐ¼ä±äÁ¿
 367   1              unsigned char tab1,tab2,tab3;  //DS18B20ÊµÑé:ÖÐ¼ä±äÁ¿
 368   1              unsigned char tab_C[2]="¡æ";   //DS18B20ÊµÑé:¡æ·ûºÅ
 369   1      
 370   1              unsigned char DTMF_data;  //DTMF½âÂëÖµ--------->Ë«Òô¶àÆµÊµÑéÏà¹Ø±äÁ¿
 371   1      
 372   1          Init_Device(); //¾§Õñ¡£¹Ü½Å³õÊ¼»¯
 373   1              Start_GSM();//GSMÉÏµç
 374   1              GSM_check();///¼ì²âµ¥Æ¬»úÓëÄ£¿éÊÇ·ñÁ¬½ÓÕý³£¡£ ×¢£ºÌøÏßÑ¡Ôñµ¥Æ¬»úÓëÄ£¿éÁ¬½Ó---,Èç¹ûÑ¡ÔñÄ£¿éÓë¼ÆËã»úÍ¨Ñ¶¹¦Ä
             -Ü£¬Çë½«Ð©Óï¾äÆÁ±Î
 375   1                //////////////////////LCD1602Òº¾§ÏÔÊ¾²âÊÔ³ÌÐò---START//////////////////////////
 376   1                /////////AÌ×¼þ³ÌÐò
 377   1                
 378   1                LCMInit_1602(); //LCM1602³õÊ¼»¯
 379   1                Delay5Ms();Delay5Ms();Delay5Ms();//LCM³õÊ¼»¯ÑÓÊ±
 380   1            DisplayListChar(3, 0,8, uctech);   //ÔÚµÚÒ»ÐÐÏÔÊ¾"Welcome!"
 381   1            DisplayListChar(0, 1,16, net);     //ÔÚµÚ¶þÐÐÏÔÊ¾"mcuep.taobao.com"
 382   1                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 383   1                DisplayListChar(0, 1,16, table);     //ÔÚµÚ¶þÐÐÏÔÊ¾"0123456789"
 384   1                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 385   1                //////////////////////LCD1602Òº¾§ÏÔÊ¾²âÊÔ³ÌÐò---END////////////////////////////
 386   1          while(1)
 387   1              { 
 388   2                   //////////////////////LCD12864Òº¾§ÏÔÊ¾²âÊÔ³ÌÐò---START//////////////////////
 389   2                       ////////////////1:Í¼ÐÍÏÔÊ¾ÊµÑé//////////////////////////
 390   2                        initina2();            //µ÷ÓÃLCDÏÔÊ¾Í¼Æ¬(À©Õ¹)³õÊ¼»¯³ÌÐò
 391   2                DisplayGraphic(pic2);  //ÏÔÊ¾Í¼Æ¬2
 392   2                        Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 393   2                
 394   2                        ///////////////2:ºº×ÖÏÔÊ¾ÊµÑé1//////////////////////////
 395   2                initinal();                    //µ÷ÓÃLCD×Ö¿â³õÊ¼»¯³ÌÐò
 396   2                delay(200);            //´óÓÚ100uSµÄÑÓÊ±³ÌÐò
 397   2                lcd_mesg(IC_DAT);      //ÏÔÊ¾ÖÐÎÄºº×Ö1
 398   2                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 399   2      
 400   2                        ///////////////3:ºº×ÖÏÔÊ¾ÊµÑé2//////////        
 401   2                LCMInit_12864();       //µ÷ÓÃLCD×Ö¿â³õÊ¼»¯³ÌÐò
 402   2                delay(200);            //´óÓÚ100uSµÄÑÓÊ±³ÌÐò 
 403   2                lcd_mesg(IC_DAT2);     //ÏÔÊ¾ÖÐÎÄºº×Ö2
 404   2                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 405   2                        
 406   2      
 407   2      
 408   2                ///////////////4:²âÎÂÏÔÊ¾ÊµÑé1--<Ö¸¶¨Î»ÖÃÏÔÊ¾>//////////////
 409   2                        LCMInit_12864();//³õÊ¼»¯Òº¾§ÇÒÇåÆÁ
 410   2                        Read_B20_SN();//¶ÁDS18B20ÐòÁÐºÅ
 411   2                        while(1)
 412   2                        {
 413   3      
 414   3                        Display_String(1,0,net4,12);     //"ÎÂ¶È¿ØÖÆÊµÑé"
 415   3                        Display_String(0,1,tm_up,10);    //"ÎÂ¶ÈÉÏÏÞ:"
 416   3                        Display_String(0,2,tm_down,10);  //"ÎÂ¶ÈÏÂÏÞ:"
 417   3                Display_String(0,3,tm_p,10);     //"µ±Ç°ÎÂ¶È:"
 418   3      
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 8   

 419   3      
 420   3                table_temp2[0]=(tm_up_point/10)+0x30;       //ÎÂ¶ÈÉÏÏÞÊ®Î»
 421   3                table_temp2[1]=(tm_up_point%10)+0x30;       //ÎÂ¶ÈÉÏÏÞ¸öÎ»
 422   3                        table_temp2[2]=tab_C[0];                    //ÏÔÊ¾ÎÂ¶È·ûºÅ"¡æ"
 423   3                        table_temp2[3]=tab_C[1];                    //ÏÔÊ¾ÎÂ¶È·ûºÅ"¡æ"
 424   3                table_temp3[0]=(tm_down_point/10)+0x30;     //ÎÂ¶ÈÏÂÏÞÊ®Î»
 425   3                table_temp3[1]=(tm_down_point%10)+0x30;     //ÎÂ¶ÈÏÂÏÞ¸öÎ»
 426   3                table_temp3[2]=tab_C[0];                    //ÏÔÊ¾ÎÂ¶È·ûºÅ"¡æ"
 427   3                table_temp3[3]=tab_C[1];                    //ÏÔÊ¾ÎÂ¶È·ûºÅ"¡æ"
 428   3                Display_String(5,1,table_temp2,4);           //LCD12864Òº¾§ÉÏÏÔÊ¾Éè¶¨ÎÂ¶ÈÉÏÏÞ
 429   3                Display_String(5,2,table_temp3,4);           //LCD12864Òº¾§ÉÏÏÔÊ¾Éè¶¨ÎÂ¶ÈÏÂÏÞ
 430   3      
 431   3                        TT=Read_Temperature();//¶ÁÎÂ¶È
 432   3                        ////////////ÒÔÏÂÎª²ð·ÖÎÂ¶ÈÖµÇÒ±äÎªASCIIÂë½øÐÐÒº¾§ÏÔÊ¾//////
 433   3                tab1 = TT / 100;   
 434   3                table_temp[0] = tab1 + 0x30;     // Ê®Î»   
 435   3                tab2= TT / 10 - tab1*10;   
 436   3                table_temp[1] = tab2 + 0x30;     //¸öÎ»   
 437   3                table_temp[2] = '.';  
 438   3                tab3 = TT - tab1*100 - tab2*10;   
 439   3                table_temp[3] = tab3 + 0x30;     //Ð¡ÊýµãÒ»Î»   
 440   3      
 441   3                        table_temp[4] =tab_C[0];//ÏÔÊ¾ÎÂ¶È·ûºÅ"¡æ"
 442   3                        table_temp[5] =tab_C[1];//ÏÔÊ¾ÎÂ¶È·ûºÅ"¡æ"         
 443   3                        Display_String(5,3,table_temp,6);//LCD12864Òº¾§ÉÏÏÔÊ¾ÎÂ¶ÈÖµ
 444   3                          
 445   3                        }
 446   2                ///////////////5:ºº×ÖÏÔÊ¾ÊµÑé3--<GPS¶¨Î»ÊµÑéÇÒÊý¾Ý12864Òº¾§ÏÔÊ¾>//////////////
 447   2                LCMInit_12864();//³õÊ¼»¯Òº¾§ÇÒÇåÆÁ
 448   2                        while(1)
 449   2                        {
 450   3                  Display_String(1,0,net3,12);    //"ÎÀÐÇ¶¨Î»ÊµÑé"
 451   3                          Display_String(0,1,gps_tm,6);   //"Ê±¼ä:"
 452   3                          Display_String(0,2,gps_long,6); //"Î³¶È:"
 453   3                              Display_String(0,3,gps_lg,6);   //"¾­¶È:"
 454   3                   
 455   3                              if(GPS_data_ok_flg==1)//½ÓÊÕµ½GPSÐÅÏ¢$GPRMCÖ¸Áî
 456   3                      {
 457   4                    GPS_data_ok_flg=0;
 458   4                    GPS_inf_state=GPS_data_buf[12];//'A'=0x41-->ÎÀÐÇ±¨ÎÄ¿ÉÓÃ  'V'=0x56-->ÎÀÐÇ±¨ÎÄ²»¿ÉÓÃ
 459   4                            if(GPS_inf_state==0x41)GPS_can_use=1;
 460   4                    ////////////////////¶¨Î»ÓÐÐ§ºó£º½âÎöGPSÊý¾Ý///////////////////////////////////////
 461   4                            if(GPS_can_use==1)//GPSÊý¾Ý¶¨Î»ÓÐÐ§
 462   4                            {
 463   5                                   GPS_can_use=0; //Çå³ýGPS¶¨Î»×´Ì¬
 464   5                                  //////////////////////GPSÊý¾Ý½ÓÊÕÏÔÊ¾/////////////////////////////////////////////
 465   5                                      //////////////////////Ê±¼äÏÔÊ¾/////////////////////////////////////
 466   5                      GPS_hour=(GPS_data_buf[1]-0x30)*10+(GPS_data_buf[2]-0x30)+8;//£«8ÇøÊ±¼ä¼ÆËã,ÇÒ¼ÓÈë":"
 467   5                              if(GPS_hour>23)GPS_hour=GPS_hour-24;
 468   5                      GPS_data_buf[0]=(GPS_hour/10)+0x30;
 469   5                                  GPS_data_buf[1]=(GPS_hour%10)+0x30;
 470   5                                      GPS_data_buf[2]=0x3a;//:
 471   5                                      GPS_data_buf[7]=GPS_data_buf[6];
 472   5                                      GPS_data_buf[6]=GPS_data_buf[5];
 473   5                                      GPS_data_buf[5]=0x3a;//:        
 474   5                              Display_String(3,1,GPS_data_buf,8);   //ÎÀÐÇÊ±¼ä:--Ó¦¸Ã+8×ª³É¶«°ËÇøÊ±(±±¾©Ê±¼ä)
 475   5                      //////////////////////Î³¶ÈÏÔÊ¾/////////////////////////////////////////////
 476   5                              Display_String(3,2,GPS_data_buf+14,9); //Î³¶È
 477   5                      //////////////////////¾­¶ÈÏÔÊ¾///////////////////////////////////////////// 
 478   5                              Display_String(3,3,GPS_data_buf+26,9); //¾­¶È
 479   5                                }
 480   4                              }
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 9   

 481   3                        }
 482   2       
 483   2      
 484   2                        
 485   2      
 486   2            //////////////////////LCD12864Òº¾§ÏÔÊ¾²âÊÔ³ÌÐò---END/////////////////////////
 487   2            ///////////////////////////³ÌÐòÔËÐÐ¹ý³ÌÖÐ²âÊÔÆäËüÓ²¼þÊÇ·ñÕý³£¹¤×÷//////////////
 488   2                //1¡£LEDµÆÊÇ·ñÕý³£ 2.ËÄÂ·¼ÌµçÆ÷ÎüºÏÊÇ·ñÕý³£ 3.ËÄÂ·¼ÌµçÆ÷Ö¸Ê¾µÆÊÇ·ñÕý³£  
 489   2                //4.·äÃùÆ÷¹¤×÷     5.485×ÜÏßÊÇ·ñ³É¹¦Êä³ö(¶Ë×Ó×ù¶¨Òå--->5:485_A , 6:485_B)
 490   2                LED_C1=0;spk_1; max485_send(0x0A);JDQ_C1=0;
 491   2                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 492   2                LED_C1=1;Delay_ms(60000);
 493   2                JDQ_C1=1;Delay_ms(60000);Delay_ms(60000);
 494   2      
 495   2                LED_C2=0;spk_1; max485_send(0x0B);JDQ_C2=0;
 496   2                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 497   2                LED_C2=1;Delay_ms(60000);JDQ_C2=1;Delay_ms(60000);Delay_ms(60000);
 498   2      
 499   2                P4=0xFE; spk_1; max485_send(0x0C);JDQ_C3=0;
 500   2                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 501   2                P4=0xFF;Delay_ms(60000);JDQ_C3=1;Delay_ms(60000);Delay_ms(60000);
 502   2      
 503   2                P4=0xFD;spk_1; max485_send(0x0D);JDQ_C4=0;
 504   2                Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);Delay_ms(60000);
 505   2                P4=0xFF;Delay_ms(60000);JDQ_C4=1;Delay_ms(60000);Delay_ms(60000);
 506   2              }
 507   1                              
 508   1      }
*** WARNING C280 IN LINE 370 OF MAIN.C: 'DTMF_data': unreferenced local variable
 509          /*
 510                    //////////////5:DTMFÊµÑé//////////////
 511                            if(DTMF_DV==1)//½ÓÊÕµ½³É¹¦µÄDTMFÐÅºÅÊä³ö¸ßµçÆ½
 512                    {
 513                              DTMF_OE =1;spk_1;
 514                                  DTMF_data=P2&0x0F;
 515                            }
 516                    if(DTMF_data==1)//½ÓÊÕµ½³É¹¦µÄDTMFÐÅºÅÊä³ö¸ßµçÆ½
 517                    {
 518                     LED_C1=0;
 519                             spk_1;
 520                    }
 521                    if(DTMF_data==8)//½âÂë³É¹¦Êä³ö¸ßµçÆ½
 522                            {
 523                      LED_C2=0;
 524                                  spk_1;
 525                            }
 526                     if(DTMF_data==5)//½âÂë³É¹¦Êä³ö¸ßµçÆ½
 527                            {
 528                      LED_C1=1;
 529                              LED_C2=1;
 530          
 531                            }*/   
 532          ///////////////////////////////////////////////////////////////////////
 533          //UART0,115200BPS µ¥Æ¬»úÖÐ¶Ï½ÓÊÕSIM900a´®¿ÚÍ¨Ñ¶ÖÐ¶Ï´¦Àí³ÌÐò
 534          ///////////////////////////////////////////////////////////////////////
 535          void SIM900a_UART_REC(void) interrupt INTERRUPT_UART0 using 3
 536          {
 537   1              EA=0;
 538   1              if(RI0)
 539   1              {       
 540   2                SIM900a_BUF[Rx]=SBUF0;  //¶ÌÐÅ×¨ÓÃBUF
 541   2                    if(Rx==70)Rx=0;
C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 10  

 542   2                    else
 543   2                    Rx++;
 544   2              }
 545   1          RI0=0;
 546   1          EA=1;
 547   1      }
 548          //////////////////////////////////////////////////////////////////////
 549          //UART1,ÅäÖÃÎª£º19200BPS µ¥Æ¬»úÖÐ¶Ï·½Ê½½ÓÊÕGPS¶¨Î»±¨ÎÄ³ÌÐò 
 550          //½âÎö£º$GPRMCµçÎÄ
 551          ///////////////////////////////////////////////////////////////////////
 552          void isr_UART_1(void) interrupt INTERRUPT_UART1 using 3
 553          {
 554   1              unsigned char tmp;
 555   1              EA=0;
 556   1              if(IsRI1)
 557   1              {       
 558   2                tmp=SBUF1;
 559   2                if(tmp=='$')//ÅÐ¶Ï±¨ÎÄÕëÍ·"$"
 560   2                {
 561   3                   GPS_Flg1=1;
 562   3                       goto  over_1;
 563   3                       
 564   3                }
 565   2                if(GPS_Flg2==1)
 566   2                {
 567   3                   if(GPS_head_buf[0]=='G'&&GPS_head_buf[1]=='P'&&GPS_head_buf[2]=='R'&&GPS_head_buf[3]=='M'&&GPS_head_
             -buf[4]=='C')//½ÓÊÕ±¨ÎÄÐÅÏ¢GPRMC
 568   3                       {
 569   4                         GPS_data_buf[data__point]=tmp;
 570   4                         data__point++;
 571   4                         if(data__point==60)
 572   4                         {
 573   5                           data__point=0;
 574   5                           GPS_Flg2=0;//Çå³ý½ÓÊÕÐÅÏ¢
 575   5                               GPS_data_ok_flg=1;//GPSÊý¾Ý½ÓÊÕÒ»´ÎÍê³É±êÖ¾
 576   5                         }
 577   4                       }
 578   3                       else
 579   3               {
 580   4                         GPS_Flg2=0;//Çå³ý½ÓÊÕÐÅÏ¢
 581   4                       }
 582   3                }
 583   2                if(GPS_Flg1==1)//½ÓÊÕ±¨ÎÄÃüÁî×Ö
 584   2                {
 585   3                   
 586   3               GPS_head_buf[head__point]=tmp;
 587   3                       head__point++;
 588   3                       if(head__point==5)
 589   3                       {
 590   4                         head__point=0;
 591   4                         GPS_Flg1=0;//Çå³ý½ÓÊÕ±¨ÎÄÃüÁî×Ö
 592   4                         GPS_Flg2=1;
 593   4                       }
 594   3                }
 595   2      over_1:
 596   2             ClrRI1(); //RI1=0;       
 597   2              }
 598   1          EA=1;
 599   1      }
 600          
 601                            

C51 COMPILER V7.09   MAIN                                                                  09/16/2011 03:31:17 PAGE 11  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1268    ----
   CONSTANT SIZE    =   2603    ----
   XDATA SIZE       =    680       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
